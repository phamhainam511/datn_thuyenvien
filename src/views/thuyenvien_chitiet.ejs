<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>PITSCO Crew Management System - Users</title>

    <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <link href="/css/style.css" rel="stylesheet">

    <%- include('partials/header', { title: 'Th√¥ng tin thuy·ªÅn vi√™n', baseUrl: '/' }) %>

</head>

<body id="page-top">

    <div id="wrapper">

        <%- include('partials/sidebar', { activeMenu: 'crews', baseUrl: '/' }) %>

        <div id="content-wrapper" class="d-flex flex-column">

            <div id="content">

                <%- include('partials/topbar', { baseUrl: '/' }) %>

                <div class="container-fluid">
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Th√¥ng tin thuy·ªÅn vi√™n</h1>
                        <div class="d-flex">
                            <a href="#" id="exportInfoBtn" class="btn btn-sm btn-info shadow-sm me-5"
                                style="margin-right: 5px;">
                                <i class="fas fa-file-export fa-sm text-white-50 me-2"></i> Xu·∫•t th√¥ng tin
                            </a>

                            <a href="#" id="exportContractBtn" class="btn btn-sm btn-primary shadow-sm">
                                <i class="fas fa-file-export fa-sm text-white-50 me-2"></i> Xu·∫•t h·ª£p ƒë·ªìng
                            </a>
                        </div>
                    </div>

                    <ul class="nav nav-tabs" id="crewTabs">
                        <li class="nav-item">
                            <a class="nav-link active" id="personal-tab" data-toggle="tab" href="#personal-info"
                                role="tab">Th√¥ng tin c√° nh√¢n</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="family-tab" data-toggle="tab" href="#family-info" role="tab">Th√¥ng
                                tin gia ƒë√¨nh</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="education-tab" data-toggle="tab" href="#education-info"
                                role="tab">H·ªçc v·∫•n</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="language-tab" data-toggle="tab" href="#language-certificates"
                                role="tab">Ch·ª©ng ch·ªâ ngo·∫°i ng·ªØ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="certificates-tab" data-toggle="tab" href="#crew-certificates"
                                role="tab">Ch·ª©ng ch·ªâ thuy·ªÅn vi√™n</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="history-tab" data-toggle="tab" href="#sailing-history"
                                role="tab">L·ªãch s·ª≠ ƒëi t√†u</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="attachments-tab" data-toggle="tab" href="#crew-attachments"
                                role="tab">T√†i li·ªáu ƒë√≠nh k√®m</a>
                        </li>
                    </ul>

                    <div class="tab-content mt-3">
                        <!--Tab th√¥ng tin c√° nh√¢n -->
                        <div class="tab-pane fade show active" id="personal-info" role="tabpanel"
                            aria-labelledby="personal-tab">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <div class="row">
                                        <!-- ·∫¢nh thuy·ªÅn vi√™n & tr·∫°ng th√°i -->
                                        <div class="col-md-3 text-center">
                                            <img src="<%= thuyenvieninfo.anh ? thuyenvieninfo.anh : '/img/crew_test1.jpg' %>"
                                                alt="·∫¢nh thuy·ªÅn vi√™n" class="crew-photo mb-2">
                                            <h5 class="fw-bold mb-1">
                                                <%= thuyenvieninfo.hoten %>
                                            </h5>
                                            <p class="text-muted mb-2">Ch·ª©c v·ª•: test</p>

                                            <!-- N√∫t upload ·∫£nh -->
                                            <form action="/upload-anh-thuyen-vien/<%= thuyenvieninfo.id_thuyenvien %>"
                                                method="POST" enctype="multipart/form-data" class="mb-2">

                                                <div class="form-group mb-2">
                                                    <div class="custom-file text-left">
                                                        <input type="file" class="custom-file-input" id="crew_photo"
                                                            name="crew_photo" accept=".jpg,.jpeg,.png">
                                                        <label class="custom-file-label" for="crew_photo">Ch·ªçn
                                                            ·∫£nh...</label>
                                                    </div>
                                                </div>

                                                <button type="submit" class="btn btn-sm btn-info mt-2">
                                                    <i class="fas fa-upload"></i> C·∫≠p nh·∫≠t ·∫£nh
                                                </button>
                                            </form>

                                            <!-- N√∫t c·∫≠p nh·∫≠t tr·∫°ng th√°i thui -->
                                            <% let statusClass = ''; %>
                                            <% if(thuyenvieninfo.trangthai === 'ƒêang tr√™n t√†u') { %>
                                            <% statusClass = 'active'; %>
                                            <% } else if(thuyenvieninfo.trangthai === 'ƒêang ch·ªù t√†u') { %>
                                            <% statusClass = 'waiting'; %>
                                            <% } else { %>
                                            <% statusClass = 'inactive'; %>
                                            <% } %>
                                            <p class="status <%= statusClass %>"><%= thuyenvieninfo.trangthai %></p>

                                            <!-- N√∫t c·∫≠p nh·∫≠t -->
                                            <div class="text-center mt-4">
                                                <div class="btn-group">
                                                    <% if (thuyenvieninfo.trangthai !== '') { %>
                                                    <button type="button" class="btn btn-primary" id="statusButtonIdx">
                                                        C·∫≠p nh·∫≠t tr·∫°ng th√°i
                                                    </button>
                                                    <button type="button"
                                                        class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                                                        data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false">
                                                        <span class="sr-only">Toggle Dropdown</span>
                                                    </button>
                                                    <div class="dropdown-menu">
                                                        <% if (thuyenvieninfo.trangthai === 'ƒêang tr√™n b·ªù') { %>
                                                        <a class="dropdown-item" href="#" data-toggle="modal"
                                                            data-target="#waitingStatusModal">ƒêang ch·ªù t√†u</a>
                                                        <% } %>
                                                        <% if (thuyenvieninfo.trangthai === 'ƒêang ch·ªù t√†u') { %>
                                                        <a class="dropdown-item" href="#" data-toggle="modal"
                                                            data-target="#boardingStatusModal">ƒêang tr√™n t√†u</a>
                                                        <% } %>
                                                        <% if (thuyenvieninfo.trangthai === 'ƒêang tr√™n t√†u') { %>
                                                        <a class="dropdown-item" href="#" data-toggle="modal"
                                                            data-target="#disembarkingStatusModal">ƒêang tr√™n b·ªù</a>
                                                        <% } %>
                                                    </div>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Th√¥ng tin c√° nh√¢n -->
                                        <div class="col-md-9">
                                            <h5 class="text-primary d-inline-block">Th√¥ng tin c√° nh√¢n</h5>
                                            <a href="#" class="ml-2" data-toggle="modal" data-target="#editModal">
                                                <i class="fas fa-edit text-primary" style="font-size: 20px;"></i>
                                            </a>
                                            <ul class="list-group mb-3">
                                                <li class="list-group-item"><strong>H·ªç v√† t√™n:</strong> <span
                                                        id="fullName">
                                                        <%= thuyenvieninfo.hoten %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>Ng√†y sinh:</strong> <span id="dob">
                                                        <%= thuyenvieninfo.ngaysinh %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>CCCD:</strong> <span id="idNumber">
                                                        <%= thuyenvieninfo.cccd %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>Chi·ªÅu cao:</strong> <span
                                                        id="height">
                                                        <%= thuyenvieninfo.chieucao %> cm
                                                    </span></li>
                                                <li class="list-group-item"><strong>C√¢n n·∫∑ng:</strong> <span
                                                        id="weight">
                                                        <%= thuyenvieninfo.cannang %> kg
                                                    </span></li>
                                                <li class="list-group-item"><strong>Nh√≥m m√°u:</strong> <span
                                                        id="bloodType">
                                                        <%= thuyenvieninfo.nhommau %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>Size gi√†y:</strong> <span
                                                        id="shoeSize">
                                                        <%= thuyenvieninfo.sizegiay %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>Size gi√†y b·∫£o h·ªô:</strong> <span
                                                        id="safetyShoeSize">
                                                        <%= thuyenvieninfo.sizegiaybaoho %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>Email:</strong> <span id="email">
                                                        <%= thuyenvieninfo.email %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span
                                                        id="phone">
                                                        <%= thuyenvieninfo.sodienthoai %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>T√¨nh tr·∫°ng h√¥n nh√¢n:</strong> <span
                                                        id="maritalStatus">
                                                        <%= thuyenvieninfo.tinhtranghonnhan %>
                                                    </span></li>
                                                <li class="list-group-item"><strong>Nguy·ªán v·ªçng ƒëi t√†u:</strong> <span
                                                        id="maritalStatus">
                                                        <%= thuyenvieninfo.ghichu %>
                                                    </span></li>

                                                <li class="list-group-item"><strong>Th·ªùi gian l√™n t√†u d·ª± ki·∫øn: </strong>
                                                    <span id="thoigianLenTau">
                                                        <%= thuyenvieninfo.thoigian_lenTauDuKien %>
                                                    </span></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Th√¥ng tin gia ƒë√¨nh -->
                        <div class="tab-pane fade" id="family-info" role="tabpanel" aria-labelledby="family-tab">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <h5 class="text-primary d-inline-block">Th√¥ng tin gia ƒë√¨nh</h5>
                                    <a href="#" class="ml-2" data-toggle="modal" data-target="#editFamilyModal">
                                        <i class="fas fa-edit text-primary" style="font-size: 20px;"></i>
                                    </a>
                                    <ul class="list-group mb-3">
                                        <li class="list-group-item"><strong>H·ªç t√™n b·ªë:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.hotenbo %>
                                            </span></li>
                                        <li class="list-group-item"><strong>S·ªë ƒëi·ªán tho·∫°i b·ªë:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.sdtbo %>
                                            </span></li>
                                        <li class="list-group-item"><strong>H·ªç t√™n m·∫π:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.hotenme %>
                                            </span></li>
                                        <li class="list-group-item"><strong>S·ªë ƒëi·ªán tho·∫°i m·∫π:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.sdtme %>
                                            </span></li>
                                        <li class="list-group-item"><strong>H·ªç t√™n v·ª£:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.hotenvo %>
                                            </span></li>
                                        <li class="list-group-item"><strong>S·ªë ƒëi·ªán tho·∫°i v·ª£:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.sdtvo %>
                                            </span></li>
                                        <li class="list-group-item"><strong>H·ªç t√™n ng∆∞·ªùi gi√°m h·ªô:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.nguoigiamho %>
                                            </span></li>
                                        <li class="list-group-item"><strong>S·ªë ƒëi·ªán tho·∫°i ng∆∞·ªùi gi√°m h·ªô:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.sdtgiamho %>
                                            </span></li>
                                        <li class="list-group-item"><strong>ƒê·ªãa ch·ªâ:</strong> <span>
                                                <%= nhanthanthuyenvieninfo.diachi %>
                                            </span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Th√¥ng tin h·ªçc v·∫•n -->
                        <div class="tab-pane fade" id="education-info" role="tabpanel" aria-labelledby="education-tab">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <h5 class="text-primary d-inline-block">Th√¥ng tin h·ªçc v·∫•n</h5>
                                    <% if (!hocvaninfo) { %>
                                    <a href="#" class="ml-2" data-toggle="modal" data-target="#addEducationModal">
                                        <i class="fas fa-plus-circle text-success" style="font-size: 20px;"></i>
                                    </a>
                                    <% } else { %>
                                    <a href="#" class="ml-2 editEducationBtn" data-toggle="modal"
                                        data-target="#editEducationModal" data-id="<%= hocvaninfo.id %>"
                                        data-school="<%= hocvaninfo.truongdaotao %>"
                                        data-program="<%= hocvaninfo.hedaotao %>"
                                        data-year="<%= hocvaninfo.namtotnghiep %>">
                                        <i class="fas fa-edit text-primary" style="font-size: 20px;"></i>
                                    </a>
                                    <% } %>

                                    <% if (!hocvaninfo) { %>
                                    <div class="alert alert-info mt-3">
                                        <p class="mb-0">Ch∆∞a c√≥ th√¥ng tin h·ªçc v·∫•n. Vui l√≤ng th√™m th√¥ng tin h·ªçc v·∫•n cho
                                            thuy·ªÅn vi√™n.</p>
                                    </div>
                                    <% } else { %>
                                    <ul class="list-group mt-3">
                                        <li class="list-group-item"><strong>Tr∆∞·ªùng ƒë√†o t·∫°o:</strong>
                                            <%= hocvaninfo.truongdaotao %></li>
                                        <li class="list-group-item"><strong>H·ªá ƒë√†o t·∫°o:</strong>
                                            <%= hocvaninfo.hedaotao %></li>
                                        <li class="list-group-item"><strong>NƒÉm t·ªët nghi·ªáp:</strong>
                                            <%= hocvaninfo.namtotnghiep %></li>
                                    </ul>

                                    <div class="mt-3">
                                        <a href="/xoa-hoc-van/<%= hocvaninfo.id %>/<%= thuyenvieninfo.id_thuyenvien %>"
                                            class="btn btn-sm btn-danger"
                                            onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a th√¥ng tin h·ªçc v·∫•n n√†y?')">
                                            <i class="fas fa-trash"></i> X√≥a th√¥ng tin h·ªçc v·∫•n
                                        </a>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- Th√¥ng tin ngo·∫°i ng·ªØ -->
                        <div class="tab-pane fade" id="language-certificates" role="tabpanel"
                            aria-labelledby="language-tab">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <h5 class="text-primary d-inline-block">Ch·ª©ng ch·ªâ ngo·∫°i ng·ªØ</h5>
                                    <a href="#" class="ml-2" data-toggle="modal" data-target="#addLanguageModal">
                                        <i class="fas fa-plus-circle text-success" style="font-size: 20px;"></i>
                                    </a>

                                    <% if (!ngoainguinfo || ngoainguinfo.length === 0) { %>
                                    <div class="alert alert-info mt-3">
                                        <p class="mb-0">Ch∆∞a c√≥ ch·ª©ng ch·ªâ ngo·∫°i ng·ªØ. Vui l√≤ng th√™m ch·ª©ng ch·ªâ ngo·∫°i ng·ªØ
                                            cho thuy·ªÅn vi√™n.</p>
                                    </div>
                                    <% } else { %>
                                    <div class="table-responsive mt-3">
                                        <table class="table table-bordered">
                                            <thead class="table-secondary">
                                                <tr>
                                                    <th>Ng√¥n ng·ªØ</th>
                                                    <th>T√™n ch·ª©ng ch·ªâ</th>
                                                    <th>ƒêi·ªÉm s·ªë</th>
                                                    <th>Ng√†y c·∫•p</th>
                                                    <th>Ng√†y h·∫øt h·∫°n</th>
                                                    <th>File ƒë√≠nh k√®m</th>
                                                    <th>Thao t√°c</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% for (let i = 0; i < ngoainguinfo.length; i++) { %>
                                                <tr>
                                                    <td><%= ngoainguinfo[i].ngonngu %></td>
                                                    <td><%= ngoainguinfo[i].tenchungchi %></td>
                                                    <td><%= ngoainguinfo[i].diemso %></td>
                                                    <td>
                                                        <% 
                                                            let nc = ngoainguinfo[i].ngaycap;
                                                            let formattedNc = 'N/A';
                                                            if (nc) {
                                                            let d = new Date(nc);
                                                            let dd = String(d.getDate()).padStart(2, '0');
                                                            let mm = String(d.getMonth() + 1).padStart(2, '0'); // v√¨ th√°ng b·∫Øt ƒë·∫ßu t·ª´ 0
                                                            let yyyy = d.getFullYear();
                                                            formattedNc = `${dd}/${mm}/${yyyy}`;
                                                            }
                                                        %>
                                                        <%= formattedNc %>
                                                    </td>
                                                    <td>
                                                        <% 
                                                            let nhh = ngoainguinfo[i].ngayhethan;
                                                            let formattedNh = 'N/A';
                                                            if (nhh) {
                                                            let d = new Date(nhh);
                                                            let dd = String(d.getDate()).padStart(2, '0');
                                                            let mm = String(d.getMonth() + 1).padStart(2, '0');
                                                            let yyyy = d.getFullYear();
                                                            formattedNh = `${dd}/${mm}/${yyyy}`;
                                                            }
                                                        %>
                                                        <%= formattedNh %>
                                                    </td>
                                                    <td>
                                                        <% if (ngoainguinfo[i].file) { %>
                                                        <a href="<%= ngoainguinfo[i].file %>" target="_blank"
                                                            class="btn btn-sm btn-info">
                                                            <i class="fas fa-file-download"></i> Xem
                                                        </a>
                                                        <% } else { %>
                                                        Kh√¥ng c√≥ file
                                                        <% } %>
                                                    </td>
                                                    <td class="text-center">
                                                        <button class="btn btn-sm btn-warning editLanguageBtn"
                                                            data-id="<%= ngoainguinfo[i].id %>"
                                                            data-language="<%= ngoainguinfo[i].ngonngu %>"
                                                            data-certificate="<%= ngoainguinfo[i].tenchungchi %>"
                                                            data-score="<%= ngoainguinfo[i].diemso %>"
                                                            data-issued="<%= ngoainguinfo[i].ngaycap ? (typeof ngoainguinfo[i].ngaycap === 'string' ? ngoainguinfo[i].ngaycap.split('T')[0] : (ngoainguinfo[i].ngaycap instanceof Date ? ngoainguinfo[i].ngaycap.toISOString().split('T')[0] : ngoainguinfo[i].ngaycap)) : '' %>"
                                                            data-expired="<%= ngoainguinfo[i].ngayhethan ? (typeof ngoainguinfo[i].ngayhethan === 'string' ? ngoainguinfo[i].ngayhethan.split('T')[0] : (ngoainguinfo[i].ngayhethan instanceof Date ? ngoainguinfo[i].ngayhethan.toISOString().split('T')[0] : ngoainguinfo[i].ngayhethan)) : '' %>"
                                                            data-file="<%= ngoainguinfo[i].file %>" data-toggle="modal"
                                                            data-target="#editLanguageModal">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <a href="/xoa-ngoai-ngu/<%= ngoainguinfo[i].id %>/<%= thuyenvieninfo.id_thuyenvien %>"
                                                            class="btn btn-sm btn-danger"
                                                            onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ch·ª©ng ch·ªâ n√†y?')">
                                                            <i class="fas fa-trash"></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- Th√¥ng tin ch·ª©ng ch·ªâ -->
                        <div class="tab-pane fade" id="crew-certificates" role="tabpanel"
                            aria-labelledby="certificates-tab">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <h5 class="text-primary d-inline-block">Ch·ª©ng ch·ªâ thuy·ªÅn vi√™n</h5>
                                    <a href="#" class="ml-2" data-toggle="modal" data-target="#addCrewCertModal">
                                        <i class="fas fa-plus-circle text-success" style="font-size: 20px;"></i>
                                    </a>

                                    <% if (!chungchiinfo || chungchiinfo.length === 0) { %>
                                    <div class="alert alert-info mt-3">
                                        <p class="mb-0">Ch∆∞a c√≥ ch·ª©ng ch·ªâ thuy·ªÅn vi√™n. Vui l√≤ng th√™m ch·ª©ng ch·ªâ cho
                                            thuy·ªÅn vi√™n.</p>
                                    </div>
                                    <% } else { %>
                                    <div class="table-responsive mt-3">
                                        <table class="table table-bordered">
                                            <thead class="table-secondary">
                                                <tr>
                                                    <th>T√™n ch·ª©ng ch·ªâ</th>
                                                    <th>S·ªë hi·ªáu</th>
                                                    <th>Ng√†y c·∫•p</th>
                                                    <th>Ng√†y h·∫øt h·∫°n</th>
                                                    <th>N∆°i c·∫•p</th>
                                                    <th>X·∫øp lo·∫°i</th>
                                                    <th>File ƒë√≠nh k√®m</th>
                                                    <th>Thao t√°c</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <% for (let i = 0; i < chungchiinfo.length; i++) { %>
                                                <tr>
                                                    <td><%= chungchiinfo[i].chungchi ? chungchiinfo[i].chungchi.tenchungchi : '' %>
                                                    </td>
                                                    <td><%= chungchiinfo[i].sohieuchungchi %></td>
                                                    <td>
                                                        <% 
                                                            let ngaycap = chungchiinfo[i].ngaycap;
                                                            let formattedDate = 'N/A';
                                                            if (ngaycap) {
                                                            let d = new Date(ngaycap);
                                                            let dd = String(d.getDate()).padStart(2, '0');
                                                            let mm = String(d.getMonth() + 1).padStart(2, '0'); // th√°ng b·∫Øt ƒë·∫ßu t·ª´ 0
                                                            let yyyy = d.getFullYear();
                                                            formattedDate = `${dd}/${mm}/${yyyy}`;
                                                            }
                                                        %>
                                                        <%= formattedDate %>
                                                    </td>
                                                    <td>
                                                        <% 
                                                            let ngayhethan = chungchiinfo[i].ngayhethan;
                                                            let formattedNgayHetHan = 'N/A'; // üü¢ ƒë·∫∑t t√™n kh√°c ƒë·ªÉ kh√¥ng tr√πng
                                                            if (ngayhethan) {
                                                            let d = new Date(ngayhethan);
                                                            let dd = String(d.getDate()).padStart(2, '0');
                                                            let mm = String(d.getMonth() + 1).padStart(2, '0');
                                                            let yyyy = d.getFullYear();
                                                            formattedNgayHetHan = `${dd}/${mm}/${yyyy}`;
                                                            }
                                                        %>
                                                        <%= formattedNgayHetHan %>
                                                    </td>

                                                    <td><%= chungchiinfo[i].noicap %></td>
                                                    <td><%= chungchiinfo[i].xeploai %></td>
                                                    <td>
                                                        <% if (chungchiinfo[i].file) { %>
                                                        <a href="<%= chungchiinfo[i].file %>" target="_blank"
                                                            class="btn btn-sm btn-info">
                                                            <i class="fas fa-file-download"></i> Xem
                                                        </a>
                                                        <% } else { %>
                                                        Kh√¥ng c√≥ file
                                                        <% } %>
                                                    </td>
                                                    <td class="text-center">
                                                        <button class="btn btn-sm btn-warning editCrewCertBtn"
                                                            data-id="<%= chungchiinfo[i].id %>"
                                                            data-cert-id="<%= chungchiinfo[i].id_chungchi %>"
                                                            data-cert-number="<%= chungchiinfo[i].sohieuchungchi %>"
                                                            data-issued="<%= chungchiinfo[i].ngaycap ? (typeof chungchiinfo[i].ngaycap === 'string' ? chungchiinfo[i].ngaycap.split('T')[0] : (chungchiinfo[i].ngaycap instanceof Date ? chungchiinfo[i].ngaycap.toISOString().split('T')[0] : chungchiinfo[i].ngaycap)) : '' %>"
                                                            data-expired="<%= chungchiinfo[i].ngayhethan ? (typeof chungchiinfo[i].ngayhethan === 'string' ? chungchiinfo[i].ngayhethan.split('T')[0] : (chungchiinfo[i].ngayhethan instanceof Date ? chungchiinfo[i].ngayhethan.toISOString().split('T')[0] : chungchiinfo[i].ngayhethan)) : '' %>"
                                                            data-issuer="<%= chungchiinfo[i].noicap %>"
                                                            data-rank="<%= chungchiinfo[i].xeploai %>"
                                                            data-file="<%= chungchiinfo[i].file %>" data-toggle="modal"
                                                            data-target="#editCrewCertModal">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <a href="/xoa-chung-chi/<%= chungchiinfo[i].id %>/<%= thuyenvieninfo.id_thuyenvien %>"
                                                            class="btn btn-sm btn-danger"
                                                            onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ch·ª©ng ch·ªâ n√†y?')">
                                                            <i class="fas fa-trash"></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                                <% } %>
                                            </tbody>
                                        </table>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- L·ªãch s·ª≠ ƒëi t√†u -->
                        <div class="tab-pane fade" id="sailing-history" role="tabpanel" aria-labelledby="history-tab">
                            <div id="tab-content" class="card shadow mb-4">
                                <div class="card-body">
                                    <h5 class="text-primary d-inline-block">L·ªãch s·ª≠ ƒëi t√†u</h5>
                                    <a href="#" class="ml-2" data-toggle="modal" data-target="#addShipHistoryModal">
                                        <i class="fas fa-plus-circle text-success" style="font-size: 20px;"></i>
                                    </a>
                                    <table class="table table-bordered">
                                        <thead class="table-secondary">
                                            <tr>
                                                <th>T√™n t√†u</th>
                                                <th>V·ªã tr√≠</th>
                                                <th>Ng√†y xu·∫•t c·∫£nh</th>
                                                <th>Ng√†y gi·ªù t√†u</th>
                                                <th>Ng√†y r·ªùi t√†u</th>
                                                <th>C·∫£ng xu·ªëng t√†u</th>
                                                <th>Qu·ªëc t·ªãch thuy·ªÅn vi√™n</th>
                                                <th>Thao t√°c</th>
                                            </tr>
                                        </thead>
                                        <% for (let i = 0; i < lichsuditauinfo.length; i++) { %>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <% 
                                                    let shipName = "Unknown";
                                                    if (tauinfo) {
                                                        const ship = tauinfo.find(ship => ship.id_tau === lichsuditauinfo[i].tau_id);
                                                        if (ship) {
                                                            shipName = ship.tentau;
                                                        }
                                                    }
                                                    %>
                                                    <%= shipName %>
                                                </td>
                                                <td>
                                                    <% 
                                                    let vitri = "Unknown";
                                                    if (chucvuinfo) {
                                                        const chucvu = chucvuinfo.find(chucvu => chucvu.id_chucvu === lichsuditauinfo[i].chucvu_id);
                                                        if (chucvu) {
                                                            vitri = chucvu.tenchucvu;
                                                        }
                                                    }
                                                    %>
                                                    <%= vitri %>
                                                </td>
                                                <td><%= lichsuditauinfo[i].timexuatcanh.toLocaleString() %>
                                                </td>
                                                <td><%= lichsuditauinfo[i].timelentau.toLocaleString() %></td>
                                                <td class="ngayroitau"><%= lichsuditauinfo[i].ngayroitau %></td>
                                                <td><%= lichsuditauinfo[i].cangroitau %></td>
                                                <td><%= lichsuditauinfo[i].quoctich_thuyen %></td>
                                                <td class="text-center">
                                                    <button class="btn btn-sm btn-warning editShipHistoryBtn"
                                                        data-history-id="<%= lichsuditauinfo[i].id_lichsuditau %>"
                                                        data-ship-id="<%= lichsuditauinfo[i].tau_id %>"
                                                        data-position-id="<%= lichsuditauinfo[i].chucvu_id %>"
                                                        data-thuyenvien-id="<%= lichsuditauinfo[i].thuyenvien_id %>"
                                                        data-toggle="modal" data-target="#editShipHistoryModal"><i
                                                            class="fas fa-edit"></i></button>
                                                    <button class="btn btn-sm btn-danger delete-btn"
                                                        data-history-id="<%= lichsuditauinfo[i].id_lichsuditau %>"><i
                                                            class="fas fa-trash"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                        <% } %>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- T·ªáp ƒë√≠nh k√®m -->
                        <div class="tab-pane fade" id="crew-attachments" role="tabpanel"
                            aria-labelledby="attachments-tab">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <h5 class="text-primary">T√†i li·ªáu ƒë√≠nh k√®m</h5>

                                    <form action="/upload-tai-lieu/<%= thuyenvieninfo.id_thuyenvien %>" method="POST"
                                        enctype="multipart/form-data">
                                        <div class="row mt-4">
                                            <!-- CCCD M·∫∑t tr∆∞·ªõc -->
                                            <div class="col-md-6 mb-4">
                                                <div class="card">
                                                    <div class="card-header bg-light">
                                                        <h6 class="mb-0">CCCD M·∫∑t Tr∆∞·ªõc</h6>
                                                    </div>
                                                    <div class="card-body text-center">
                                                        <% if (tailieuinfo && tailieuinfo.cccd_mattruoc) { %>
                                                        <img src="<%= tailieuinfo.cccd_mattruoc %>" alt="CCCD M·∫∑t Tr∆∞·ªõc"
                                                            class="img-fluid mb-3" style="max-height: 200px;">
                                                        <div class="d-flex justify-content-center">
                                                            <a href="<%= tailieuinfo.cccd_mattruoc %>" target="_blank"
                                                                class="btn btn-sm btn-info mr-2">
                                                                <i class="fas fa-eye"></i> Xem
                                                            </a>
                                                            <a href="/xoa-tai-lieu/<%= thuyenvieninfo.id_thuyenvien %>/cccd_mattruoc"
                                                                class="btn btn-sm btn-danger"
                                                                onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i li·ªáu n√†y?')">
                                                                <i class="fas fa-trash"></i> X√≥a
                                                            </a>
                                                        </div>
                                                        <% } else { %>
                                                        <div class="text-center py-4">
                                                            <i class="fas fa-id-card fa-4x text-muted mb-3"></i>
                                                            <p class="text-muted">Ch∆∞a c√≥ t√†i li·ªáu</p>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="cccd_mattruoc">T·∫£i l√™n CCCD M·∫∑t Tr∆∞·ªõc:</label>
                                                            <input type="file" class="form-control-file"
                                                                id="cccd_mattruoc" name="cccd_mattruoc"
                                                                accept=".jpg,.jpeg,.png,.pdf">
                                                        </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- CCCD M·∫∑t sau -->
                                            <div class="col-md-6 mb-4">
                                                <div class="card">
                                                    <div class="card-header bg-light">
                                                        <h6 class="mb-0">CCCD M·∫∑t Sau</h6>
                                                    </div>
                                                    <div class="card-body text-center">
                                                        <% if (tailieuinfo && tailieuinfo.cccd_matsau) { %>
                                                        <img src="<%= tailieuinfo.cccd_matsau %>" alt="CCCD M·∫∑t Sau"
                                                            class="img-fluid mb-3" style="max-height: 200px;">
                                                        <div class="d-flex justify-content-center">
                                                            <a href="<%= tailieuinfo.cccd_matsau %>" target="_blank"
                                                                class="btn btn-sm btn-info mr-2">
                                                                <i class="fas fa-eye"></i> Xem
                                                            </a>
                                                            <a href="/xoa-tai-lieu/<%= thuyenvieninfo.id_thuyenvien %>/cccd_matsau"
                                                                class="btn btn-sm btn-danger"
                                                                onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i li·ªáu n√†y?')">
                                                                <i class="fas fa-trash"></i> X√≥a
                                                            </a>
                                                        </div>
                                                        <% } else { %>
                                                        <div class="text-center py-4">
                                                            <i class="fas fa-id-card fa-4x text-muted mb-3"></i>
                                                            <p class="text-muted">Ch∆∞a c√≥ t√†i li·ªáu</p>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="cccd_matsau">T·∫£i l√™n CCCD M·∫∑t Sau:</label>
                                                            <input type="file" class="form-control-file"
                                                                id="cccd_matsau" name="cccd_matsau"
                                                                accept=".jpg,.jpeg,.png,.pdf">
                                                        </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Phi·∫øu ti√™m v·∫Øc xin -->
                                            <div class="col-md-6 mb-4">
                                                <div class="card">
                                                    <div class="card-header bg-light">
                                                        <h6 class="mb-0">Phi·∫øu Ti√™m V·∫Øc Xin</h6>
                                                    </div>
                                                    <div class="card-body text-center">
                                                        <% if (tailieuinfo && tailieuinfo.phieutiemvacxin) { %>
                                                        <img src="<%= tailieuinfo.phieutiemvacxin %>"
                                                            alt="Phi·∫øu Ti√™m V·∫Øc Xin" class="img-fluid mb-3"
                                                            style="max-height: 200px;">
                                                        <div class="d-flex justify-content-center">
                                                            <a href="<%= tailieuinfo.phieutiemvacxin %>" target="_blank"
                                                                class="btn btn-sm btn-info mr-2">
                                                                <i class="fas fa-eye"></i> Xem
                                                            </a>
                                                            <a href="/xoa-tai-lieu/<%= thuyenvieninfo.id_thuyenvien %>/phieutiemvacxin"
                                                                class="btn btn-sm btn-danger"
                                                                onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i li·ªáu n√†y?')">
                                                                <i class="fas fa-trash"></i> X√≥a
                                                            </a>
                                                        </div>
                                                        <% } else { %>
                                                        <div class="text-center py-4">
                                                            <i class="fas fa-syringe fa-4x text-muted mb-3"></i>
                                                            <p class="text-muted">Ch∆∞a c√≥ t√†i li·ªáu</p>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="phieutiemvacxin">T·∫£i l√™n Phi·∫øu Ti√™m V·∫Øc
                                                                Xin:</label>
                                                            <input type="file" class="form-control-file"
                                                                id="phieutiemvacxin" name="phieutiemvacxin"
                                                                accept=".jpg,.jpeg,.png,.pdf">
                                                        </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Ch·ª©ng nh·∫≠n v√†ng da -->
                                            <div class="col-md-6 mb-4">
                                                <div class="card">
                                                    <div class="card-header bg-light">
                                                        <h6 class="mb-0">Ch·ª©ng Nh·∫≠n V√†ng Da</h6>
                                                    </div>
                                                    <div class="card-body text-center">
                                                        <% if (tailieuinfo && tailieuinfo.chungnhanvangda) { %>
                                                        <img src="<%= tailieuinfo.chungnhanvangda %>"
                                                            alt="Ch·ª©ng Nh·∫≠n V√†ng Da" class="img-fluid mb-3"
                                                            style="max-height: 200px;">
                                                        <div class="d-flex justify-content-center">
                                                            <a href="<%= tailieuinfo.chungnhanvangda %>" target="_blank"
                                                                class="btn btn-sm btn-info mr-2">
                                                                <i class="fas fa-eye"></i> Xem
                                                            </a>
                                                            <a href="/xoa-tai-lieu/<%= thuyenvieninfo.id_thuyenvien %>/chungnhanvangda"
                                                                class="btn btn-sm btn-danger"
                                                                onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i li·ªáu n√†y?')">
                                                                <i class="fas fa-trash"></i> X√≥a
                                                            </a>
                                                        </div>
                                                        <% } else { %>
                                                        <div class="text-center py-4">
                                                            <i class="fas fa-file-medical fa-4x text-muted mb-3"></i>
                                                            <p class="text-muted">Ch∆∞a c√≥ t√†i li·ªáu</p>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="chungnhanvangda">T·∫£i l√™n Ch·ª©ng Nh·∫≠n V√†ng
                                                                Da:</label>
                                                            <input type="file" class="form-control-file"
                                                                id="chungnhanvangda" name="chungnhanvangda"
                                                                accept=".jpg,.jpeg,.png,.pdf">
                                                        </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="text-center mt-3">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-upload"></i> T·∫£i l√™n t√†i li·ªáu
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL POPUP C·∫¨P NH·∫¨T TH√îNG TIN -->
                    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editModalLabel">C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="updateForm"
                                        action="/cap-nhat-thuyen-vien/<%= thuyenvieninfo.id_thuyenvien %>"
                                        method="POST">

                                        <div class="form-group">
                                            <label>H·ªç v√† t√™n:</label>
                                            <input type="text" class="form-control validate-text" maxlength="30" id="inputFullName" name="hoten"
                                                value="<%= thuyenvieninfo.hoten %>">
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y sinh:</label>
                                            <input type="date" class="form-control" id="inputDob" name="ngaysinh"
                                                value="<%= thuyenvieninfo.ngaysinh %>">
                                        </div>
                                        <div class="form-group">
                                            <label>CCCD:</label>
                                            <input type="text" class="form-control validate-int" maxlength="12" id="inputIdNumber" name="cccd"
                                                value="<%= thuyenvieninfo.cccd %>">
                                        </div>
                                        <div class="form-group">
                                            <label>Chi·ªÅu cao:</label>
                                            <input type="text" class="form-control validate-int" data-min="160" data-max="250" maxlength="3" id="inputHeight" name="chieucao"
                                                value="<%= thuyenvieninfo.chieucao %>">
                                        </div>
                                        <div class="form-group">
                                            <label>C√¢n n·∫∑ng:</label>
                                            <input type="text" step="0.1" class="form-control validate-float" data-min="50" data-max="120" id="inputWeight" name="cannang"
                                                value="<%= thuyenvieninfo.cannang %>">
                                        </div>
                                        <div class="form-group">
                                            <label>Nh√≥m m√°u:</label>
                                            <select class="form-control" id="inputBloodType" name="nhommau"
                                                value="<%= thuyenvieninfo.nhommau %>">
                                                <option value="A">A</option>
                                                <option value="B">B</option>
                                                <option value="AB">AB</option>
                                                <option value="O">O</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Size gi√†y:</label>
                                            <input type="text" class="form-control validate-int" data-min="36" data-max="45" maxlength="2" id="inputShoeSize" name="sizegiay"
                                                value="<%= thuyenvieninfo.sizegiay %>">
                                        </div>
                                        <div class="form-group">
                                            <label>Size gi√†y b·∫£o h·ªô:</label>
                                            <input type="text" class="form-control validate-int" data-min="36" data-max="45" maxlength="2" id="inputSafetyShoeSize"
                                                name="sizegiaybaoho" value="<%= thuyenvieninfo.sizegiaybaoho %>">
                                        </div>
                                        <div class="form-group">
                                            <label>Email:</label>
                                            <input type="email" class="form-control validate-email" id="inputEmail" name="email"
                                                value="<%= thuyenvieninfo.email %>">
                                        </div>
                                        <div class="form-group">
                                            <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                                            <input type="text" class="form-control validate-int" maxlength="10" id="inputPhone" name="sodienthoai"
                                                value="<%= thuyenvieninfo.sodienthoai %>">
                                        </div>
                                        <div class="form-group">
                                            <label>T√¨nh tr·∫°ng h√¥n nh√¢n:</label>
                                            <select class="form-control" id="inputMaritalStatus" name="tinhtranghonnhan"
                                                value="<%= thuyenvieninfo.tinhtranghonnhan %>">
                                                <option value="ƒê·ªôc th√¢n">ƒê·ªôc th√¢n</option>
                                                <option value="ƒê√£ k·∫øt h√¥n">ƒê√£ k·∫øt h√¥n</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="ghichu">Nguy·ªán v·ªçng ƒëi t√†u:</label>
                                            <textarea class="form-control" id="ghichu" name="ghichu"
                                                rows="3"><%= thuyenvieninfo.ghichu || '' %></textarea>
                                        </div>
                                        <% 
                                            const rawDateTime = new Date(thuyenvieninfo.thoigian_lenTauDuKien);
                                            const formattedDateTime = rawDateTime.toISOString().slice(0,16); 
                                        %>
                                        <div class="form-group">
                                            <label>Ng√†y l√™n t√†u d·ª± ki·∫øn:</label>
                                            <input type="datetime-local" class="form-control" id=""
                                                name="thoigian_lenTauDuKien"
                                                value="<%= formattedDateTime %>">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" id="saveChanges" form="updateForm">L∆∞u
                                        thay ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL POPUP C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI - ƒêANG CH·ªú T√ÄU -->
                    <div class="modal fade" id="waitingStatusModal" tabindex="-1" role="dialog"
                        aria-labelledby="waitingStatusModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="waitingStatusModalLabel">C·∫≠p nh·∫≠t tr·∫°ng th√°i - ƒêang ch·ªù
                                        t√†u</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="waitingStatusForm"
                                        action="/cap-nhat-trang-thai/<%= thuyenvieninfo.id_thuyenvien %>" method="POST">
                                        <input type="hidden" name="trangthai" value="ƒêang ch·ªù t√†u">
                                        
                                        <div class="form-group">
                                            <label>Th·ªùi gian l√™n t√†u d·ª± ki·∫øn:</label>
                                            <input type="datetime-local" class="form-control"
                                                name="thoigian_lenTauDuKien">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" form="waitingStatusForm">L∆∞u thay
                                        ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL POPUP C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI - ƒêANG TR√äN T√ÄU -->
                    <div class="modal fade" id="boardingStatusModal" tabindex="-1" role="dialog"
                        aria-labelledby="boardingStatusModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="boardingStatusModalLabel">C·∫≠p nh·∫≠t tr·∫°ng th√°i - ƒêang
                                        tr√™n t√†u</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="boardingStatusForm"
                                        action="/cap-nhat-trang-thai/<%= thuyenvieninfo.id_thuyenvien %>" method="POST">
                                        <input type="hidden" name="trangthai" value="ƒêang tr√™n t√†u">

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>T√™n t√†u:</label>
                                                    <select class="form-control" name="tau_id" required>
                                                        <% tauinfo.forEach(function(tau) { %>
                                                        <option value="<%= tau.id_tau %>"><%= tau.tentau %></option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>V·ªã tr√≠:</label>
                                                    <select class="form-control" name="chucvu_id" required>
                                                        <% chucvuinfo.forEach(function(chucvu) { %>
                                                        <option value="<%= chucvu.id_chucvu %>"><%= chucvu.tenchucvu %>
                                                        </option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Ng√†y gi·ªù xu·∫•t c·∫£nh:</label>
                                                    <input type="datetime-local" class="form-control" name="timexuatcanh"
                                                        required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Ng√†y gi·ªù l√™n t√†u:</label>
                                                    <input type="datetime-local" class="form-control" name="timelentau"
                                                        required>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" form="boardingStatusForm">L∆∞u thay
                                        ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL POPUP C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI - ƒêANG TR√äN B·ªú -->
                    <div class="modal fade" id="disembarkingStatusModal" tabindex="-1" role="dialog"
                        aria-labelledby="disembarkingStatusModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="disembarkingStatusModalLabel">C·∫≠p nh·∫≠t tr·∫°ng th√°i - ƒêang
                                        tr√™n b·ªù</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="disembarkingStatusForm"
                                        action="/cap-nhat-trang-thai/<%= thuyenvieninfo.id_thuyenvien %>" method="POST">
                                        <input type="hidden" name="trangthai" value="ƒêang tr√™n b·ªù">
                                        <div class="form-group">
                                            <label>C·∫£ng r·ªùi t√†u:</label>
                                            <input type="text" class="form-control" name="cangroitau">
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y r·ªùi t√†u:</label>
                                            <input type="date" class="form-control" name="ngayroitau">
                                        </div>
                                        <div class="form-group">
                                            <label>Qu·ªëc t·ªãch thuy·ªÅn:</label>
                                            <input type="text" class="form-control" name="quoctich_thuyen">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" form="disembarkingStatusForm">L∆∞u thay
                                        ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL POPUP C·∫¨P NH·∫¨T TH√îNG TIN GIA ƒê√åNH -->
                    <div class="modal fade" id="editFamilyModal" tabindex="-1" role="dialog"
                        aria-labelledby="editFamilyModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editFamilyModalLabel">C·∫≠p nh·∫≠t th√¥ng tin gia ƒë√¨nh</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="updateFamilyForm"
                                        action="/cap-nhat-than-nhan/<%= thuyenvieninfo.id_thuyenvien %>" method="POST">
                                        <div class="form-group">
                                            <label>H·ªç t√™n b·ªë:</label>
                                            <input type="text" class="form-control validate-text" maxlength="30" id="inputFatherName" name="hotenbo"
                                                value="<%= nhanthanthuyenvieninfo.hotenbo %>">
                                        </div>
                                        <div class="form-group">
                                            <label>S·ªë ƒëi·ªán tho·∫°i b·ªë:</label>
                                            <input type="text" class="form-control validate-int" maxlength="10" id="inputFatherPhone" name="sdtbo"
                                                value="<%= nhanthanthuyenvieninfo.sdtbo %>">
                                        </div>
                                        <div class="form-group">
                                            <label>H·ªç t√™n m·∫π:</label>
                                            <input type="text" class="form-control validate-text" maxlength="30" id="inputMotherName" name="hotenme"
                                                value="<%= nhanthanthuyenvieninfo.hotenme %>">
                                        </div>
                                        <div class="form-group">
                                            <label>S·ªë ƒëi·ªán tho·∫°i m·∫π:</label>
                                            <input type="text" class="form-control validate-int" maxlength="10" id="inputMotherPhone" name="sdtme"
                                                value="<%= nhanthanthuyenvieninfo.sdtme %>">
                                        </div>
                                        <div class="form-group">
                                            <label>H·ªç t√™n v·ª£/ch·ªìng:</label>
                                            <input type="text" class="form-control validate-text" maxlength="30" id="inputSpouseName" name="hotenvo"
                                                value="<%= nhanthanthuyenvieninfo.hotenvo %>">
                                        </div>
                                        <div class="form-group">
                                            <label>S·ªë ƒëi·ªán tho·∫°i v·ª£/ch·ªìng:</label>
                                            <input type="text" class="form-control validate-int" maxlength="10" id="inputSpousePhone" name="sdtvo"
                                                value="<%= nhanthanthuyenvieninfo.sdtvo %>">
                                        </div>
                                        <div class="form-group">
                                            <label>H·ªç t√™n ng∆∞·ªùi gi√°m h·ªô:</label>
                                            <input type="text" class="form-control validate-text" maxlength="30" id="inputGuardianName"
                                                name="nguoigiamho" value="<%= nhanthanthuyenvieninfo.nguoigiamho %>">
                                        </div>
                                        <div class="form-group">
                                            <label>S·ªë ƒëi·ªán tho·∫°i ng∆∞·ªùi gi√°m h·ªô:</label>
                                            <input type="text" class="form-control validate-int" maxlength="10" id="inputGuardianPhone"
                                                name="sdtgiamho" value="<%= nhanthanthuyenvieninfo.sdtgiamho %>">
                                        </div>
                                        <div class="form-group">
                                            <label>ƒê·ªãa ch·ªâ:</label>
                                            <textarea class="form-control" id="inputAddress" name="diachi"
                                                rows="3"><%= nhanthanthuyenvieninfo.diachi %></textarea>
                                        </div>
                                        <input type="hidden" name="thuyenvien_id"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" id="saveFamilyChanges"
                                        form="updateFamilyForm">L∆∞u thay ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- MODAL TH√äM L·ªäCH S·ª¨ ƒêI T√ÄU -->
                    <div class="modal fade" id="addShipHistoryModal" tabindex="-1" role="dialog"
                        aria-labelledby="addShipHistoryModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Th√™m l·ªãch s·ª≠ ƒëi t√†u</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="addShipHistoryForm" action="/them-lich-su-di-tau" method="POST">
                                        <input type="hidden" name="thuyenvien_id"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                        <div class="form-group">
                                            <label>T√™n t√†u:</label>
                                            <select class="form-control" id="newShipName" name="tau_id" required>
                                                <% tauinfo.forEach(function(tau) { %>
                                                <option value="<%= tau.id_tau %>"><%= tau.tentau %></option>
                                                <% }); %>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>V·ªã tr√≠:</label>
                                            <select class="form-control" id="newPosition" name="chucvu_id" required>
                                                <% chucvuinfo.forEach(function(chucvu) { %>
                                                <option value="<%= chucvu.id_chucvu %>"><%= chucvu.tenchucvu %></option>
                                                <% }); %>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y gi·ªù xu·∫•t c·∫£nh:</label>
                                            <input type="datetime-local" class="form-control" id="newOnboardDate"
                                                name="timexuatcanh" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y gi·ªù l√™n t√†u:</label>
                                            <input type="datetime-local" class="form-control" id="newOnboardTime"
                                                name="timelentau" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y r·ªùi t√†u:</label>
                                            <input type="date" class="form-control" id="newOffboardDate"
                                                name="ngayroitau">
                                        </div>
                                        <div class="form-group">
                                            <label>C·∫£ng xu·ªëng t√†u:</label>
                                            <input type="text" class="form-control" id="newPort" name="cangroitau">
                                        </div>
                                        <div class="form-group">
                                            <label>Qu·ªëc t·ªãch thuy·ªÅn:</label>
                                            <input type="text" class="form-control" id="newNationality"
                                                name="quoctich_thuyen">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-success" form="addShipHistoryForm">Th√™m l·ªãch
                                        s·ª≠</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL CH·ªàNH S·ª¨A L·ªäCH S·ª¨ ƒêI T√ÄU -->
                    <div class="modal fade" id="editShipHistoryModal" tabindex="-1" role="dialog"
                        aria-labelledby="editShipHistoryModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Ch·ªânh s·ª≠a l·ªãch s·ª≠ ƒëi t√†u</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="editShipHistoryForm" action="/cap-nhat-lich-su-di-tau" method="POST">
                                        <input type="hidden" id="editHistoryId" name="id_lichsuditau" value="">
                                        <input type="hidden" id="editThuyenVienId" name="thuyenvien_id" value="">
                                        <div class="form-group">
                                            <label>T√™n t√†u:</label>
                                            <select class="form-control" id="editShipName" name="tau_id" required>
                                                <% tauinfo.forEach(function(tau) { %>
                                                <option value="<%= tau.id_tau %>"><%= tau.tentau %></option>
                                                <% }); %>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>V·ªã tr√≠:</label>
                                            <select class="form-control" id="editPosition" name="chucvu_id" required>
                                                <% chucvuinfo.forEach(function(chucvu) { %>
                                                <option value="<%= chucvu.id_chucvu %>"><%= chucvu.tenchucvu %></option>
                                                <% }); %>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y gi·ªù xu·∫•t c·∫£nh:</label>
                                            <input type="datetime-local" class="form-control" id="editOnboardDate"
                                                name="timexuatcanh" required value="">
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y gi·ªù l√™n t√†u:</label>
                                            <input type="datetime-local" class="form-control" id="editOnboardTime"
                                                name="timelentau" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y r·ªùi t√†u:</label>
                                            <input type="date" class="form-control" id="editOffboardDate"
                                                name="ngayroitau">
                                        </div>
                                        <div class="form-group">
                                            <label>C·∫£ng xu·ªëng t√†u:</label>
                                            <input type="text" class="form-control" id="editPort" name="cangroitau">
                                        </div>
                                        <div class="form-group">
                                            <label>Qu·ªëc t·ªãch thuy·ªÅn vi√™n:</label>
                                            <input type="text" class="form-control" id="editNationality"
                                                name="quoctich_thuyen">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" id="saveEditShipHistory"
                                        form="editShipHistoryForm">L∆∞u thay ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL TH√äM H·ªåC V·∫§N -->
                    <div class="modal fade" id="addEducationModal" tabindex="-1" role="dialog"
                        aria-labelledby="addEducationModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Th√™m th√¥ng tin h·ªçc v·∫•n</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="addEducationForm" action="/them-hoc-van" method="POST">
                                        <input type="hidden" name="id_thuyenvien"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                        <div class="form-group">
                                            <label>Tr∆∞·ªùng ƒë√†o t·∫°o:</label>
                                            <input type="text" class="form-control" name="truongdaotao" required>
                                        </div>
                                        <div class="form-group">
                                            <label>H·ªá ƒë√†o t·∫°o:</label>
                                            <select class="form-control" name="hedaotao" required>
                                                <option value="Trung c·∫•p">Trung c·∫•p</option>
                                                <option value="Cao ƒë·∫≥ng">Cao ƒë·∫≥ng</option>
                                                <option value="ƒê·∫°i h·ªçc">ƒê·∫°i h·ªçc</option>
                                                <option value="Sau ƒë·∫°i h·ªçc">Sau ƒë·∫°i h·ªçc</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>NƒÉm t·ªët nghi·ªáp:</label>
                                            <input type="number" class="form-control validate-int" data-min="1980" data-max="2030" maxlength="4" name="namtotnghiep" required>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-success" form="addEducationForm">Th√™m h·ªçc
                                        v·∫•n</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL CH·ªàNH S·ª¨A H·ªåC V·∫§N -->
                    <div class="modal fade" id="editEducationModal" tabindex="-1" role="dialog"
                        aria-labelledby="editEducationModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Ch·ªânh s·ª≠a th√¥ng tin h·ªçc v·∫•n</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="editEducationForm" action="/cap-nhat-hoc-van" method="POST">
                                        <input type="hidden" id="editEducationId" name="id"
                                            value="">
                                        <input type="hidden" name="id_thuyenvien"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                        <div class="form-group">
                                            <label>Tr∆∞·ªùng ƒë√†o t·∫°o:</label>
                                            <input type="text" class="form-control" id="editSchool" name="truongdaotao"
                                                required value="">
                                        </div>
                                        <div class="form-group">
                                            <label>H·ªá ƒë√†o t·∫°o:</label>
                                            <select class="form-control" id="editProgram" name="hedaotao" required
                                                value="">
                                                <option value="Trung c·∫•p">Trung c·∫•p</option>
                                                <option value="Cao ƒë·∫≥ng">Cao ƒë·∫≥ng</option>
                                                <option value="ƒê·∫°i h·ªçc">ƒê·∫°i h·ªçc</option>
                                                <option value="Sau ƒë·∫°i h·ªçc">Sau ƒë·∫°i h·ªçc</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>NƒÉm t·ªët nghi·ªáp:</label>
                                            <input type="number" class="form-control validate-int" data-min="1980" data-max="2030" maxlength="4"  id="editYear" name="namtotnghiep"
                                                required value="">
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" form="editEducationForm">L∆∞u thay
                                        ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL TH√äM CH·ª®NG CH·ªà NGO·∫†I NG·ªÆ -->
                    <div class="modal fade" id="addLanguageModal" tabindex="-1" role="dialog"
                        aria-labelledby="addLanguageModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Th√™m ch·ª©ng ch·ªâ ngo·∫°i ng·ªØ</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="addLanguageForm" action="/them-ngoai-ngu" method="POST"
                                        enctype="multipart/form-data">
                                        <input type="hidden" name="id_thuyenvien"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                        <div class="form-group">
                                            <label>Ng√¥n ng·ªØ:</label>
                                            <select class="form-control" name="ngonngu" required>
                                                <option value="Ti·∫øng Anh">Ti·∫øng Anh</option>
                                                <option value="Ti·∫øng Nh·∫≠t">Ti·∫øng Nh·∫≠t</option>
                                                <option value="Ti·∫øng H√†n">Ti·∫øng H√†n</option>
                                                <option value="Ti·∫øng Trung">Ti·∫øng Trung</option>
                                                <option value="Kh√°c">Kh√°c</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>T√™n ch·ª©ng ch·ªâ:</label>
                                            <input type="text" class="form-control" name="tenchungchi" required>
                                        </div>
                                        <div class="form-group">
                                            <label>ƒêi·ªÉm s·ªë:</label>
                                            <input type="number" step="0.1" class="form-control validate-float" name="diemso" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y c·∫•p:</label>
                                            <input type="date" class="form-control" name="ngaycap" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y h·∫øt h·∫°n:</label>
                                            <input type="date" class="form-control" name="ngayhethan">
                                        </div>
                                        <div class="form-group">
                                            <label>File ch·ª©ng ch·ªâ:</label>
                                            <input type="file" class="form-control-file" name="certificate_file"
                                                accept=".pdf,.jpg,.jpeg,.png">
                                            <small class="form-text text-muted">Ch·∫•p nh·∫≠n file PDF, JPG, JPEG,
                                                PNG</small>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-success" form="addLanguageForm">Th√™m ch·ª©ng
                                        ch·ªâ</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL CH·ªàNH S·ª¨A CH·ª®NG CH·ªà NGO·∫†I NG·ªÆ -->
                    <div class="modal fade" id="editLanguageModal" tabindex="-1" role="dialog"
                        aria-labelledby="editLanguageModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Ch·ªânh s·ª≠a ch·ª©ng ch·ªâ ngo·∫°i ng·ªØ</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="editLanguageForm" action="/cap-nhat-ngoai-ngu" method="POST"
                                        enctype="multipart/form-data">
                                        <input type="hidden" id="editLanguageId" name="id" value="">
                                        <input type="hidden" name="id_thuyenvien"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                        <div class="form-group">
                                            <label>Ng√¥n ng·ªØ:</label>
                                            <select class="form-control" id="editLanguage" name="ngonngu" required
                                                value="">
                                                <option value="Ti·∫øng Anh">Ti·∫øng Anh</option>
                                                <option value="Ti·∫øng Nh·∫≠t">Ti·∫øng Nh·∫≠t</option>
                                                <option value="Ti·∫øng H√†n">Ti·∫øng H√†n</option>
                                                <option value="Ti·∫øng Trung">Ti·∫øng Trung</option>
                                                <option value="Kh√°c">Kh√°c</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>T√™n ch·ª©ng ch·ªâ:</label>
                                            <input type="text" class="form-control" id="editCertificate"
                                                name="tenchungchi" required value="">
                                        </div>
                                        <div class="form-group">
                                            <label>ƒêi·ªÉm s·ªë:</label>
                                            <input type="number" step="0.1" class="form-control validate-float" id="editScore"
                                                name="diemso" required value="">
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y c·∫•p:</label>
                                            <input type="date" class="form-control" id="editIssued" name="ngaycap"
                                                required value="">
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y h·∫øt h·∫°n:</label>
                                            <input type="date" class="form-control" id="editExpired" name="ngayhethan"
                                                value="">
                                        </div>
                                        <div class="form-group">
                                            <label>File hi·ªán t·∫°i:</label>
                                            <div id="currentFileInfo" class="mb-2">
                                                <span id="currentFileName">

                                                    Kh√¥ng c√≥ file

                                                </span>
                                            </div>
                                            <label>T·∫£i l√™n file m·ªõi (n·∫øu c·∫ßn):</label>
                                            <input type="file" class="form-control-file" name="certificate_file"
                                                accept=".pdf,.jpg,.jpeg,.png">
                                            <small class="form-text text-muted">Ch·∫•p nh·∫≠n file PDF, JPG, JPEG,
                                                PNG</small>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" form="editLanguageForm">L∆∞u thay
                                        ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL TH√äM CH·ª®NG CH·ªà THUY·ªÄN VI√äN -->
                    <div class="modal fade" id="addCrewCertModal" tabindex="-1" role="dialog"
                        aria-labelledby="addCrewCertModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Th√™m ch·ª©ng ch·ªâ thuy·ªÅn vi√™n</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="addCrewCertForm" action="/them-chung-chi" method="POST"
                                        enctype="multipart/form-data">
                                        <input type="hidden" name="id_thuyenvien"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                        <div class="form-group">
                                            <label>T√™n ch·ª©ng ch·ªâ:</label>
                                            <select id="addCertificateName" class="form-control" name="id_chungchi"
                                                required>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>S·ªë hi·ªáu ch·ª©ng ch·ªâ:</label>
                                            <input type="text" class="form-control" name="sohieuchungchi" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y c·∫•p:</label>
                                            <input type="date" class="form-control" name="ngaycap" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y h·∫øt h·∫°n:</label>
                                            <input type="date" class="form-control" name="ngayhethan">
                                        </div>
                                        <div class="form-group">
                                            <label>N∆°i c·∫•p:</label>
                                            <input type="text" class="form-control" name="noicap" required>
                                        </div>
                                        <div class="form-group">
                                            <label>X·∫øp lo·∫°i:</label>
                                            <input type="text" class="form-control validate-text" name="xeploai">
                                        </div>
                                        <div class="form-group">
                                            <label>File ch·ª©ng ch·ªâ:</label>
                                            <input type="file" class="form-control-file" name="crew_certificate_file"
                                                accept=".pdf,.jpg,.jpeg,.png">
                                            <small class="form-text text-muted">Ch·∫•p nh·∫≠n file PDF, JPG, JPEG,
                                                PNG</small>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-success" form="addCrewCertForm">Th√™m ch·ª©ng
                                        ch·ªâ</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL CH·ªàNH S·ª¨A CH·ª®NG CH·ªà THUY·ªÄN VI√äN -->
                    <div class="modal fade" id="editCrewCertModal" tabindex="-1" role="dialog"
                        aria-labelledby="editCrewCertModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Ch·ªânh s·ª≠a ch·ª©ng ch·ªâ thuy·ªÅn vi√™n</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="editCrewCertForm" action="/cap-nhat-chung-chi" method="POST"
                                        enctype="multipart/form-data">
                                        <input type="hidden" id="editCrewCertId" name="id" value="">
                                        <input type="hidden" name="id_thuyenvien"
                                            value="<%= thuyenvieninfo.id_thuyenvien %>">
                                        <div class="form-group">
                                            <label>T√™n ch·ª©ng ch·ªâ:</label>
                                            <select class="form-control" id="editCrewCertName" name="id_chungchi"
                                                required>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>S·ªë hi·ªáu ch·ª©ng ch·ªâ:</label>
                                            <input type="text" class="form-control" id="editCrewCertNumber"
                                                name="sohieuchungchi" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y c·∫•p:</label>
                                            <input type="date" class="form-control" id="editCrewCertIssued"
                                                name="ngaycap" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Ng√†y h·∫øt h·∫°n:</label>
                                            <input type="date" class="form-control" id="editCrewCertExpired"
                                                name="ngayhethan">
                                        </div>
                                        <div class="form-group">
                                            <label>N∆°i c·∫•p:</label>
                                            <input type="text" class="form-control" id="editCrewCertIssuer"
                                                name="noicap" required>
                                        </div>
                                        <div class="form-group">
                                            <label>X·∫øp lo·∫°i:</label>
                                            <input type="text" class="form-control validate-text" id="editCrewCertRank"
                                                name="xeploai">
                                        </div>
                                        <div class="form-group">
                                            <label>File hi·ªán t·∫°i:</label>
                                            <div id="currentCrewCertFileInfo" class="mb-2">
                                                <span id="currentCrewCertFileName">Kh√¥ng c√≥ file</span>
                                            </div>
                                            <label>T·∫£i l√™n file m·ªõi (n·∫øu c·∫ßn):</label>
                                            <input type="file" class="form-control-file" name="crew_certificate_file"
                                                accept=".pdf,.jpg,.jpeg,.png">
                                            <small class="form-text text-muted">Ch·∫•p nh·∫≠n file PDF, JPG, JPEG,
                                                PNG</small>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                                    <button type="submit" class="btn btn-primary" form="editCrewCertForm">L∆∞u thay
                                        ƒë·ªïi</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>


                    </script>
                </div>


            </div>

            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; PITSCO Crew Management System 2025 </span>
                    </div>
                </div>
            </footer>

        </div>

    </div>

    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <%- include('partials/logout-modal') %>
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="/js/style.js"></script>
    <script src="/vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="/vendor/datatables/dataTables.bootstrap4.min.js"></script>
    <script src="/js/demo/datatables-demo.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function () {
            const rawDate = $('#dob').text().trim(); 
            const formatted = moment(rawDate).format('DD/MM/YYYY');
            $('#dob').text(formatted);
        });
        $(document).ready(function () {
            const rawDateTime = $('#thoigianLenTau').text().trim(); 
            if (rawDateTime) {
            const formatted = moment(rawDateTime).format('DD/MM/YYYY HH:mm'); 
            $('#thoigianLenTau').text(formatted);
            }
        });
        $('.ngayroitau').each(function () {
            const rawDate = $(this).text().trim();
            if (rawDate) {
                const formatted = moment(rawDate).format('DD/MM/YYYY');
                $(this).text(formatted);
            }
        });

    </script>

    <script>
            $(document).ready(function () {
                $.ajax({
                    url: '/api/chung-chi',
                    type: 'GET',
                    success: function(certificates) {
                        var select = $('#editCrewCertName');
                        select.empty();
                        
                        certificates.forEach(function(cert) {
                            select.append('<option value="' + cert.id_chungchi + '">' + cert.tenchungchi + '</option>');
                        });

                        var select = $('#addCertificateName');
                        select.empty();
                        
                        certificates.forEach(function(cert) {
                            select.append('<option value="' + cert.id_chungchi + '">' + cert.tenchungchi + '</option>');
                        });
                        
                    },
                    error: function() {
                        console.error('Failed to load certificates');
                    }
                });

                $('#crewTabs a').on('click', function (e) {
                    e.preventDefault();
                    $(this).tab('show');
                });

                $('.editEducationBtn').on('click', function() {
                    const id = $(this).data('id');
                    const school = $(this).data('school');
                    const program = $(this).data('program');
                    const year = $(this).data('year');
                    
                    $('#editEducationId').val(id);
                    $('#editSchool').val(school);
                    $('#editProgram').val(program);
                    $('#editYear').val(year);
                });
                
                $('.editLanguageBtn').on('click', function() {
                    const id = $(this).data('id');
                    const language = $(this).data('language');
                    const certificate = $(this).data('certificate');
                    const score = $(this).data('score');
                    const issued = $(this).data('issued');
                    const expired = $(this).data('expired');
                    const file = $(this).data('file');
                    
                    $('#editLanguageId').val(id);
                    $('#editLanguage').val(language);
                    $('#editCertificate').val(certificate);
                    $('#editScore').val(score);
                    $('#editIssued').val(issued);
                    $('#editExpired').val(expired);
                    
                    if (file && file !== '') {
                        $('#currentFileName').html('<a href="' + file + '" target="_blank">View current file</a>');
                    } else {
                        $('#currentFileName').text('No file attached');
                    }
                });
                
                $('.editCrewCertBtn').on('click', function() {
                    const id = $(this).data('id');
                    const certId = $(this).data('cert-id'); 
                    const certNumber = $(this).data('cert-number');
                    const issued = $(this).data('issued');
                    const expired = $(this).data('expired');
                    const issuer = $(this).data('issuer');
                    const rank = $(this).data('rank');
                    const file = $(this).data('file');
                    
                    $('#editCrewCertId').val(id);
                    $('#editCrewCertName').val(certId); 
                    $('#editCrewCertIssued').val(issued);
                    $('#editCrewCertExpired').val(expired);
                    $('#editCrewCertIssuer').val(issuer);
                    $('#editCrewCertRank').val(rank);
                    
                    if (file && file !== '') {
                        $('#currentCrewCertFileName').html('<a href="' + file + '" target="_blank">View current file</a>');
                    } else {
                        $('#currentCrewCertFileName').text('No file attached');
                    }
                });

                function parseCustomDatetimeToLocal(str) {
                    // V√≠ d·ª•: "00:14:00, 29/5/2025"
                    const regex = /(\d{2}):(\d{2}):\d{2}, (\d{1,2})\/(\d{1,2})\/(\d{4})/;
                    const match = str.match(regex);
                    if (!match) return '';

                    const [_, hh, mm, d, m, y] = match;
                    const day = d.padStart(2, '0');
                    const month = m.padStart(2, '0');
                    return `${y}-${month}-${day}T${hh}:${mm}`;
                }
                
                $('.editShipHistoryBtn').on('click', function() {
                    const historyId = $(this).data('history-id');
                    const shipId = $(this).data('ship-id');
                    const positionId = $(this).data('position-id');
                    const thuyenvienId = $(this).data('thuyenvien-id');
                    
                    const row = $(this).closest('tr');
                    const onboardDate = row.find('td:eq(2)').text(); 
                    const onboardTime = row.find('td:eq(3)').text(); 
                    const offboardDate = row.find('td:eq(4)').text();
                    const port = row.find('td:eq(5)').text();
                    const nationality = row.find('td:eq(6)').text();

                    $('#editHistoryId').val(historyId);
                    $('#editThuyenVienId').val(thuyenvienId);
                    $('#editShipName').val(shipId);
                    $('#editPosition').val(positionId);
                    $('#editOnboardDate').val(parseCustomDatetimeToLocal(onboardDate));
                    $('#editOnboardTime').val(parseCustomDatetimeToLocal(onboardTime)); 
                    $('#editOffboardDate').val(offboardDate);
                    $('#editPort').val(port);
                    $('#editNationality').val(nationality);
                });

                $('.delete-btn').click(function () {
                    const historyId = $(this).data('history-id');
                    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√°?')) {
                        $.post('/xoa-lich-su-di-tau', { historyId }, function (response) {
                            alert(response.message);
                            location.reload(); 
                        }).fail(function (xhr) {
                            alert(xhr.responseJSON?.message || 'L·ªói khi xo√°');
                        });
                    }
                });
                
            });


            document.getElementById("exportContractBtn").addEventListener("click", function(e) {
                e.preventDefault();

                const pathParts = window.location.pathname.split('/');
                const idThuyenvien = pathParts[pathParts.length - 1]; 
                fetch(`/thuyenvien/export-word/${idThuyenvien}`)
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.blob();
                    })
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.href = url;
                        a.download = `hopdong_thuyenvien_${idThuyenvien}.docx`;
                        document.body.appendChild(a);
                        a.click();
                        a.remove();
                        window.URL.revokeObjectURL(url);
                    })
                    .catch(() => alert("L·ªói khi t·∫£i h·ª£p ƒë·ªìng!"));
            });

        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded");

            const statusButton = document.getElementById('statusButton');
            if (statusButton) {
                statusButton.addEventListener('click', function () {
                    const currentStatus = '<%= thuyenvieninfo.trangthai %>';

                    if (currentStatus === 'ƒêang tr√™n t√†u') {
                        $('#disembarkingStatusModal').modal('show');
                    } else if (currentStatus === 'ƒêang ch·ªù t√†u') {
                        $('#boardingStatusModal').modal('show');
                    } else {
                        $('#waitingStatusModal').modal('show');
                    }
                });
            }
        });

        document.getElementById("exportInfoBtn").addEventListener("click", function (e) {
            e.preventDefault();

            const pathParts = window.location.pathname.split('/');
            const idThuyenvien = pathParts[pathParts.length - 1]; 

            fetch(`/thuyenvien/export-excel/${idThuyenvien}`)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.blob();
                })
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;

                    a.download = `thong_tin_thuyenvien_${idThuyenvien}.xlsx`;

                    document.body.appendChild(a);
                    a.click();
                    a.remove();

                    window.URL.revokeObjectURL(url);
                })
                .catch(() => alert("L·ªói khi t·∫£i h·ª£p ƒë·ªìng!"));
        });
    </script>

    <script src="/js/validation.js"></script>
</body>

</html>